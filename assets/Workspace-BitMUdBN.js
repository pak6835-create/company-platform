var nt=Object.defineProperty;var rt=(n,s,d)=>s in n?nt(n,s,{enumerable:!0,configurable:!0,writable:!0,value:d}):n[s]=d;var Ke=(n,s,d)=>rt(n,typeof s!="symbol"?s+"":s,d);import{j as e}from"./index-CVU1Nt4s.js";import{a as r,f as ot}from"./vendor-react-BLQjSpGA.js";import{u as ie,N as me,H as G,P as Z,a as it,b as lt,c as ct,R as dt,d as ht,e as ut,S as pt,B as gt,f as mt,C as ft,M as xt}from"./vendor-reactflow-0CPYyxVc.js";function bt({data:n,selected:s,id:d}){const{setNodes:o}=ie(),[h,f]=r.useState(!1),m=(x,v)=>{o(k=>k.map(y=>y.id===d?{...y,data:{...y.data,width:v.width,height:v.height}}:y))};return e.jsxs("div",{className:`image-node ${s?"selected":""}`,style:{position:"relative",width:"100%",height:"100%"},children:[e.jsx(me,{isVisible:s,minWidth:100,minHeight:80,onResize:m}),e.jsxs("div",{className:"image-content",children:[!h&&e.jsx("div",{className:"image-loading",children:"Loading..."}),e.jsx("img",{src:n.imageUrl,alt:n.label,className:"image-thumbnail",onLoad:()=>f(!0),style:{display:h?"block":"none"},draggable:!1})]}),e.jsx("div",{className:"image-label",children:n.label}),e.jsx(G,{type:"target",position:Z.Left,id:"image-in",style:{top:"50%",transform:"translateY(-50%)",background:"#3b82f6",width:10,height:10}}),e.jsx(G,{type:"source",position:Z.Right,id:"image-out",style:{top:"50%",transform:"translateY(-50%)",background:"#10b981",width:10,height:10}})]})}function yt({id:n,data:s,selected:d}){const[o,h]=r.useState(!1),[f,m]=r.useState(s.content||""),x=r.useRef(null),{setNodes:v}=ie();r.useEffect(()=>{m(s.content||"")},[s.content]);const k=r.useMemo(()=>{if(!f)return 100;const b=f.split(`
`).length,S=60+Math.max(b,Math.ceil(f.length/25))*20;return Math.max(100,Math.min(S,500))},[f]);r.useEffect(()=>{o||v(b=>b.map(w=>{var R;if(w.id===n){const S=((R=w.style)==null?void 0:R.height)||100;if(Math.abs(S-k)>20)return{...w,style:{...w.style,height:k}}}return w}))},[k,n,v,o]),r.useEffect(()=>{o&&x.current&&(x.current.focus(),x.current.select())},[o]);const y=()=>{h(!1),v(b=>b.map(w=>w.id===n?{...w,data:{...w.data,content:f}}:w))},I=b=>{b.key==="Escape"&&(m(s.content||""),h(!1))},p=(b,w)=>{v(R=>R.map(S=>S.id===n?{...S,style:{...S.style,width:w.width,height:w.height}}:S))};return e.jsxs("div",{className:`note-node ${d?"selected":""}`,style:{backgroundColor:s.backgroundColor||"#fef3c7",width:"100%",height:"100%"},onDoubleClick:()=>h(!0),children:[e.jsx(G,{type:"target",position:Z.Left,id:"note-in"}),e.jsx(me,{isVisible:d,minWidth:150,minHeight:100,onResize:p}),o?e.jsx("textarea",{ref:x,className:"note-edit-textarea nodrag",value:f,onChange:b=>m(b.target.value),onBlur:y,onKeyDown:I,onMouseDown:b=>b.stopPropagation()}):e.jsx("div",{className:"note-content",children:f||"ë”ë¸”í´ë¦­í•˜ì—¬ í¸ì§‘"}),e.jsx(G,{type:"source",position:Z.Right,id:"note-out"})]})}function vt({id:n,data:s,selected:d}){const[o,h]=r.useState(!1),[f,m]=r.useState(s.text||""),x=r.useRef(null),{setNodes:v}=ie();r.useEffect(()=>{m(s.text||"")},[s.text]);const k=r.useMemo(()=>{const b=(s.fontSize||16)*.6;return Math.max(100,Math.min(f.length*b+24,400))},[f,s.fontSize]);r.useEffect(()=>{o||v(p=>p.map(b=>{var w;if(b.id===n){const R=((w=b.style)==null?void 0:w.width)||100;if(Math.abs(R-k)>20)return{...b,style:{...b.style,width:k}}}return b}))},[k,n,v,o]),r.useEffect(()=>{o&&x.current&&(x.current.focus(),x.current.select())},[o]);const y=()=>{h(!1),v(p=>p.map(b=>b.id===n?{...b,data:{...b.data,text:f}}:b))},I=p=>{p.key==="Enter"?y():p.key==="Escape"&&(m(s.text||""),h(!1))};return e.jsxs("div",{className:`text-node ${d?"selected":""}`,onDoubleClick:()=>h(!0),children:[e.jsx(G,{type:"target",position:Z.Left,id:"text-in"}),e.jsx(me,{isVisible:d,minWidth:100,minHeight:30}),o?e.jsx("input",{ref:x,type:"text",className:"text-edit-input nodrag",value:f,onChange:p=>m(p.target.value),onBlur:y,onKeyDown:I,onMouseDown:p=>p.stopPropagation(),style:{fontSize:s.fontSize||16,color:s.color||"#374151"}}):e.jsx("div",{className:"text-content",style:{fontSize:s.fontSize||16,color:s.color||"#374151"},children:f||"ë”ë¸”í´ë¦­í•˜ì—¬ í¸ì§‘"}),e.jsx(G,{type:"source",position:Z.Right,id:"text-out"})]})}const wt=["#3b82f6","#ef4444","#22c55e","#f59e0b","#8b5cf6","#ec4899","#06b6d4","#6b7280"];function kt({id:n,data:s,selected:d}){const[o,h]=r.useState(!1),{setNodes:f}=ie(),m=x=>{f(v=>v.map(k=>k.id===n?{...k,data:{...k.data,backgroundColor:x}}:k)),h(!1)};return e.jsxs("div",{className:`shape-node shape-${s.shape} ${d?"selected":""}`,style:{backgroundColor:s.backgroundColor||"#3b82f6",opacity:.5,width:"100%",height:"100%",position:"relative"},onDoubleClick:()=>h(!o),children:[e.jsx(G,{type:"target",position:Z.Left,id:"shape-in"}),e.jsx(me,{isVisible:d,minWidth:50,minHeight:50}),o&&e.jsx("div",{className:"shape-color-picker nodrag",style:{position:"absolute",top:"100%",left:"50%",transform:"translateX(-50%)",backgroundColor:"#1e1e1e",borderRadius:"8px",padding:"8px",display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:"4px",zIndex:1e3,marginTop:"8px",boxShadow:"0 4px 12px rgba(0,0,0,0.3)"},onMouseDown:x=>x.stopPropagation(),children:wt.map(x=>e.jsx("div",{onClick:()=>m(x),style:{width:"24px",height:"24px",backgroundColor:x,borderRadius:"4px",cursor:"pointer",border:s.backgroundColor===x?"2px solid white":"2px solid transparent"}},x))}),e.jsx(G,{type:"source",position:Z.Right,id:"shape-out"})]})}function jt({data:n,selected:s}){const[d,o]=r.useState(!1),[h,f]=r.useState(n.name||""),m=r.useRef(null);r.useEffect(()=>{d&&m.current&&(m.current.focus(),m.current.select())},[d]);const x=y=>{y.stopPropagation(),f(n.name||""),o(!0)},v=()=>{o(!1),n.onNameChange&&n.onNameChange(n.boardId,h)},k=y=>{y.key==="Enter"?v():y.key==="Escape"&&(o(!1),f(n.name||""))};return e.jsxs("div",{className:`board-node ${s?"selected":""}`,children:[e.jsx("div",{className:"board-node-icon",children:e.jsx("svg",{width:"28",height:"28",viewBox:"0 0 24 24",fill:"none",stroke:n.color||"#9ca3af",strokeWidth:"1.5",children:e.jsx("path",{d:"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"})})}),d?e.jsx("input",{ref:m,className:"board-node-input nodrag",value:h,onChange:y=>f(y.target.value),onBlur:v,onKeyDown:k,placeholder:"ë³´ë“œ ì´ë¦„"}):e.jsx("div",{className:"board-node-name",onDoubleClick:x,children:n.name||""}),(n.itemCount??0)>0&&e.jsx("div",{className:"board-node-count",children:n.itemCount})]})}function Nt({id:n,data:s,selected:d}){const{setNodes:o}=ie(),[h,f]=r.useState(!s.url),[m,x]=r.useState(s.url||""),v=r.useCallback(()=>{if(!m.trim())return;let p=m.trim();!p.startsWith("http://")&&!p.startsWith("https://")&&(p="https://"+p);let b=s.title;if(!b)try{b=new URL(p).hostname.replace("www.","")}catch{b=p}let w=s.favicon;if(!w)try{w=`https://www.google.com/s2/favicons?domain=${new URL(p).hostname}&sz=32`}catch{w=void 0}o(R=>R.map(S=>S.id===n?{...S,data:{...S.data,url:p,title:b,favicon:w}}:S)),f(!1)},[n,m,s.title,s.favicon,o]),k=r.useCallback(()=>{s.url&&window.open(s.url,"_blank","noopener,noreferrer")},[s.url]),y=r.useCallback(p=>{p.stopPropagation(),f(!0),x(s.url||"")},[s.url]),I=r.useCallback(p=>{p.key==="Enter"?v():p.key==="Escape"&&(f(!1),x(s.url||""))},[v,s.url]);return e.jsxs("div",{className:`link-card-node ${d?"selected":""}`,onDoubleClick:y,children:[e.jsx(G,{type:"target",position:Z.Left,id:"link-in"}),h?e.jsxs("div",{className:"link-card-edit nodrag",children:[e.jsx("input",{type:"text",value:m,onChange:p=>x(p.target.value),onKeyDown:I,placeholder:"URLì„ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: google.com)",autoFocus:!0}),e.jsxs("div",{className:"link-card-edit-buttons",children:[e.jsx("button",{onClick:v,className:"save-btn",children:"ì €ì¥"}),e.jsx("button",{onClick:()=>f(!1),className:"cancel-btn",children:"ì·¨ì†Œ"})]})]}):e.jsxs("div",{className:"link-card-display",onClick:k,children:[e.jsxs("div",{className:"link-card-header",children:[s.favicon&&e.jsx("img",{src:s.favicon,alt:"",className:"link-card-favicon",onError:p=>{p.target.style.display="none"}}),e.jsx("span",{className:"link-card-title",children:s.title||"ë§í¬"})]}),e.jsx("div",{className:"link-card-url",children:s.url}),e.jsx("div",{className:"link-card-hint",children:"í´ë¦­í•˜ì—¬ ì—´ê¸° â€¢ ë”ë¸”í´ë¦­í•˜ì—¬ í¸ì§‘"})]}),e.jsx(G,{type:"source",position:Z.Right,id:"link-out"})]})}function Ct({id:n,data:s,selected:d}){var D;const{setNodes:o}=ie(),[h,f]=r.useState(!1),[m,x]=r.useState(s.title||"ì²´í¬ë¦¬ìŠ¤íŠ¸"),[v,k]=r.useState(""),y=r.useMemo(()=>{var se,ne;const B=(((se=s.items)==null?void 0:se.length)||0)>0?8:0,E=32,W=((ne=s.items)==null?void 0:ne.length)||0,P=50+B+W*E+44+16;return Math.max(150,Math.min(P,500))},[(D=s.items)==null?void 0:D.length]);r.useEffect(()=>{o(l=>l.map(B=>{var E;if(B.id===n){const W=((E=B.style)==null?void 0:E.height)||150;if(Math.abs(W-y)>20)return{...B,style:{...B.style,height:y}}}return B}))},[y,n,o]);const I=r.useCallback(l=>{o(B=>B.map(E=>E.id===n?{...E,data:{...E.data,...l}}:E))},[n,o]),p=r.useCallback(()=>{I({title:m.trim()||"ì²´í¬ë¦¬ìŠ¤íŠ¸"}),f(!1)},[m,I]),b=r.useCallback(()=>{if(!v.trim())return;const l={id:`item-${Date.now()}`,text:v.trim(),checked:!1};I({items:[...s.items||[],l]}),k("")},[v,s.items,I]),w=r.useCallback(l=>{const B=(s.items||[]).map(E=>E.id===l?{...E,checked:!E.checked}:E);I({items:B})},[s.items,I]),R=r.useCallback(l=>{const B=(s.items||[]).filter(E=>E.id!==l);I({items:B})},[s.items,I]),S=r.useCallback((l,B)=>{l.key==="Enter"?(l.preventDefault(),B==="title"?p():b()):l.key==="Escape"&&B==="title"&&(f(!1),x(s.title||"ì²´í¬ë¦¬ìŠ¤íŠ¸"))},[p,b,s.title]),Y=s.items||[],O=Y.filter(l=>l.checked).length,j=Y.length;return e.jsxs("div",{className:`checklist-node ${d?"selected":""}`,style:{width:"100%",height:"100%",display:"flex",flexDirection:"column"},children:[e.jsx(me,{isVisible:d,minWidth:200,minHeight:150}),e.jsx(G,{type:"target",position:Z.Left,id:"checklist-in"}),e.jsxs("div",{className:"checklist-header",children:[h?e.jsx("input",{type:"text",value:m,onChange:l=>x(l.target.value),onKeyDown:l=>S(l,"title"),onBlur:p,className:"checklist-title-input nodrag",autoFocus:!0}):e.jsx("div",{className:"checklist-title",onDoubleClick:()=>f(!0),children:s.title||"ì²´í¬ë¦¬ìŠ¤íŠ¸"}),j>0&&e.jsxs("div",{className:"checklist-progress",children:[O,"/",j]})]}),j>0&&e.jsx("div",{className:"checklist-progress-bar",children:e.jsx("div",{className:"checklist-progress-fill",style:{width:`${O/j*100}%`}})}),e.jsx("div",{className:"checklist-items nodrag",children:Y.map(l=>e.jsxs("div",{className:`checklist-item ${l.checked?"checked":""}`,children:[e.jsx("input",{type:"checkbox",checked:l.checked,onChange:()=>w(l.id),className:"checklist-checkbox"}),e.jsx("span",{className:"checklist-item-text",children:l.text}),e.jsx("button",{className:"checklist-item-delete",onClick:()=>R(l.id),title:"ì‚­ì œ",children:"Ã—"})]},l.id))}),e.jsxs("div",{className:"checklist-add nodrag",children:[e.jsx("input",{type:"text",value:v,onChange:l=>k(l.target.value),onKeyDown:l=>S(l,"add"),placeholder:"ìƒˆ í•  ì¼ ì¶”ê°€...",className:"checklist-add-input"}),e.jsx("button",{onClick:b,className:"checklist-add-btn",disabled:!v.trim(),children:"+"})]}),e.jsx(G,{type:"source",position:Z.Right,id:"checklist-out"})]})}const Ye=[{id:"gemini-3-pro-image-preview",name:"ë‚˜ë…¸ë°”ë‚˜ë‚˜ 3 Pro"}],Dt=n=>{var d,o,h,f;const s=((h=(o=(d=n.candidates)==null?void 0:d[0])==null?void 0:o.content)==null?void 0:h.parts)||[];for(const m of s)if((f=m.inlineData)!=null&&f.data)return m.inlineData.data;return null};async function Ue(n,s,d,o=Ye[0].id,h="image/png",f,m){const x=`https://generativelanguage.googleapis.com/v1beta/models/${o}:generateContent?key=${n}`,v=[{text:d},{inlineData:{mimeType:h,data:s}}],k={responseModalities:["TEXT","IMAGE"]};(m!=null&&m.aspectRatio||m!=null&&m.imageSize)&&(k.imageConfig={},m.aspectRatio&&(k.imageConfig.aspectRatio=m.aspectRatio),m.imageSize&&(k.imageConfig.imageSize=m.imageSize));const y={contents:[{parts:v}],generationConfig:k};console.log("[editImage] ìš”ì²­:",{model:o,mimeType:h,promptLength:d.length,imageDataLength:s.length,hasReference:!1,referenceLength:0});const p=await(await fetch(x,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(y)})).json();if(console.log("[editImage] ì‘ë‹µ:",p.error?p.error:"ì„±ê³µ"),p.error)throw new Error(p.error.message||"API ì˜¤ë¥˜");const b=Dt(p);if(!b)throw new Error("ì´ë¯¸ì§€ í¸ì§‘ ì‹¤íŒ¨");return{base64:b,url:`data:image/png;base64,${b}`}}function St(n,s,d){const o=document.createElement("canvas");o.width=n.width,o.height=n.height,o.getContext("2d").putImageData(n,0,0);const f=document.createElement("canvas");f.width=s,f.height=d;const m=f.getContext("2d");return m.drawImage(o,0,0,s,d),m.getImageData(0,0,s,d)}function Et(n,s){let d=s;(n.width!==s.width||n.height!==s.height)&&(console.warn(`[extractAlpha] ì´ë¯¸ì§€ í¬ê¸° ë¶ˆì¼ì¹˜! í°ë°°ê²½: ${n.width}x${n.height}, ê²€ì •ë°°ê²½: ${s.width}x${s.height}`),console.log("[extractAlpha] ê²€ì •ë°°ê²½ ì´ë¯¸ì§€ë¥¼ í°ë°°ê²½ í¬ê¸°ë¡œ ë¦¬ì‚¬ì´ì¦ˆí•©ë‹ˆë‹¤."),d=St(s,n.width,n.height));const o=n.width,h=n.height,f=n.data,m=d.data,x=new Uint8ClampedArray(f.length),v=Math.sqrt(765*255);for(let k=0;k<o*h;k++){const y=k*4,I=f[y],p=f[y+1],b=f[y+2],w=m[y],R=m[y+1],S=m[y+2];let O=1-Math.sqrt(Math.pow(I-w,2)+Math.pow(p-R,2)+Math.pow(b-S,2))/v;O=Math.max(0,Math.min(1,O));let j=0,D=0,l=0;O>.01&&(j=w/O,D=R/O,l=S/O),x[y]=Math.round(Math.min(255,j)),x[y+1]=Math.round(Math.min(255,D)),x[y+2]=Math.round(Math.min(255,l)),x[y+3]=Math.round(O*255)}return new ImageData(x,o,h)}function He(n){return new Promise((s,d)=>{const o=new Image;o.onload=()=>{const h=document.createElement("canvas");h.width=o.width,h.height=o.height;const f=h.getContext("2d");f.drawImage(o,0,0),s(f.getImageData(0,0,h.width,h.height))},o.onerror=()=>d(new Error("ì´ë¯¸ì§€ ë¡œë“œ ì‹¤íŒ¨")),o.src=n})}function It(n){const s=document.createElement("canvas");return s.width=n.width,s.height=n.height,s.getContext("2d").putImageData(n,0,0),s.toDataURL("image/png")}const Mt=[{id:"1K",name:"1K"},{id:"2K",name:"2K"},{id:"4K",name:"4K"}],Tt=n=>{window.dispatchEvent(new CustomEvent("asset-add",{detail:n}))};function Rt({data:n,selected:s,id:d}){const{setNodes:o,setEdges:h,getNodes:f}=ie(),m=it(u=>u.edges)||[],x=r.useRef(null),[v,k]=r.useState(n.apiKey||""),[y,I]=r.useState(!1),[p,b]=r.useState(null),[w,R]=r.useState(null),[S,Y]=r.useState(!1),[O,j]=r.useState(""),[D,l]=r.useState(null),[B,E]=r.useState(0),[W,V]=r.useState("2K"),q=p||w,P=r.useMemo(()=>{let u=350;return q&&(u+=120),D&&(u+=250),S&&(u+=50),Math.max(400,Math.min(u,900))},[q,D,S]);r.useEffect(()=>{o(u=>u.map(N=>{var T;if(N.id===d){const $=((T=N.style)==null?void 0:T.height)||400;if(Math.abs($-P)>30)return{...N,style:{...N.style,height:P}}}return N}))},[P,d,o]),r.useEffect(()=>{o(u=>u.map(N=>N.id===d?{...N,data:{...N.data,apiKey:v}}:N))},[v,d,o]);const se=r.useMemo(()=>{if(!Array.isArray(m))return null;const u=m.find(N=>N.target===d&&N.targetHandle==="image-in");return(u==null?void 0:u.source)||null},[m,d]);r.useEffect(()=>{var T,$,te,ae;if(!se){R(null);return}const N=f().find(K=>K.id===se);if(N){const K=((T=N.data)==null?void 0:T.imageUrl)||(($=N.data)==null?void 0:$.url)||((te=N.data)==null?void 0:te.resultImage)||((ae=N.data)==null?void 0:ae.generatedImage);K&&(R(K),b(null))}},[se,f]);const ne=u=>{b(u),h(N=>N.filter(T=>!(T.target===d&&T.targetHandle==="image-in"))),R(null),l(null),j(""),E(0)},le=u=>{var $;const N=($=u.target.files)==null?void 0:$[0];if(!N)return;const T=new FileReader;T.onload=te=>{var K;const ae=(K=te.target)==null?void 0:K.result;ne(ae)},T.readAsDataURL(N)},ce=u=>{u.preventDefault(),u.stopPropagation();const N=u.dataTransfer.getData("application/json")||u.dataTransfer.getData("text/plain");if(N)try{const $=JSON.parse(N);if($.type==="asset"&&$.url){ne($.url);return}}catch{}const T=u.dataTransfer.files[0];if(T&&T.type.startsWith("image/")){const $=new FileReader;$.onload=te=>{var K;const ae=(K=te.target)==null?void 0:K.result;ne(ae)},$.readAsDataURL(T)}},de=async()=>{if(!v){j("âš ï¸ API í‚¤ë¥¼ ì…ë ¥í•˜ì„¸ìš”");return}if(!q){j("âš ï¸ ì´ë¯¸ì§€ë¥¼ ì—°ê²°í•˜ê±°ë‚˜ ì—…ë¡œë“œí•˜ì„¸ìš”");return}Y(!0),l(null),E(0),j("ğŸ­ ë°°ê²½ íˆ¬ëª…í™” ì²˜ë¦¬ ì¤‘...");try{const u=q.split(",")[1],N=q.split(";")[0].split(":")[1]||"image/png",T=Ye[0].id;E(10),j("ğŸ”„ í°ë°°ê²½ìœ¼ë¡œ ë³€í™˜ ì¤‘...");const $=await Ue(v,u,"Change ONLY the background color to pure solid white #FFFFFF. Do NOT modify, redraw, or change the subject in any way. Keep the exact same subject, pose, and details. Only replace the background with white.",T,N,void 0,{imageSize:W});E(40),j("ğŸ”„ ê²€ì •ë°°ê²½ìœ¼ë¡œ ë³€í™˜ ì¤‘...");const te=await Ue(v,$.base64,"Change ONLY the background color from white to pure black #000000. Do NOT modify, redraw, or change the subject in any way. Keep the exact same subject, pose, and details. Only replace the white background with black.",T,"image/png",void 0,{imageSize:W});E(75),j("âœ¨ íˆ¬ëª… ë°°ê²½ ìƒì„± ì¤‘...");const[ae,K]=await Promise.all([He($.url),He(te.url)]);E(90);const re=Et(ae,K),xe=It(re);l(xe),E(100),j("âœ… ì™„ë£Œ!"),Tt({url:xe,prompt:"íˆ¬ëª… ë°°ê²½ ë³€í™˜",timestamp:Date.now()})}catch(u){console.error("ì²˜ë¦¬ ì˜¤ë¥˜:",u),j(`âŒ ${u instanceof Error?u.message:"ì²˜ë¦¬ ì‹¤íŒ¨"}`)}finally{Y(!1)}};return e.jsxs("div",{className:`transparent-bg-node ${s?"selected":""}`,style:{background:"#1a1a2e",borderRadius:12,border:s?"2px solid #00d4ff":"2px solid #333",width:"100%",height:"100%",minHeight:550,color:"white",position:"relative",overflow:"hidden"},children:[e.jsx(me,{isVisible:s,minWidth:380,minHeight:550}),e.jsx("div",{style:{background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",padding:"12px 16px",borderRadius:"10px 10px 0 0",fontWeight:"bold",fontSize:14},children:"ğŸ–¼ï¸ ì´ë¯¸ì§€ ë°°ê²½ íˆ¬ëª…í™”"}),e.jsxs("div",{className:"nodrag",style:{padding:16,height:"calc(100% - 48px)",overflowY:"auto",overflowX:"hidden"},onMouseDown:u=>u.stopPropagation(),children:[e.jsx("div",{style:{background:"#2a2a3e",borderRadius:8,padding:12,marginBottom:12,border:"1px solid #444"},children:e.jsxs("div",{children:[e.jsx("label",{style:{fontSize:11,color:"#aaa",display:"block",marginBottom:4},children:"ğŸ“ í•´ìƒë„ (ì—…ìŠ¤ì¼€ì¼)"}),e.jsx("div",{style:{display:"flex",gap:4},children:Mt.map(u=>e.jsx("button",{onClick:()=>V(u.id),style:{flex:1,padding:"5px 8px",borderRadius:4,border:"none",background:W===u.id?"#667eea":"#3f3f46",color:(W===u.id,"#fff"),cursor:"pointer",fontSize:11,fontWeight:W===u.id?"bold":"normal"},children:u.name},u.id))})]})}),e.jsxs("div",{style:{marginBottom:12},children:[e.jsx("label",{style:{fontSize:11,color:"#aaa",display:"block",marginBottom:4},children:"Gemini API Key"}),e.jsxs("div",{style:{display:"flex",gap:6},children:[e.jsx("input",{type:y?"text":"password",value:v,onChange:u=>k(u.target.value),placeholder:"API í‚¤ ì…ë ¥",style:{flex:1,padding:"6px 10px",borderRadius:6,border:"1px solid #444",background:"#2a2a3e",color:"white",fontSize:11}}),e.jsx("button",{onClick:()=>I(!y),style:{padding:"6px 10px",borderRadius:6,border:"none",background:"#444",color:"white",cursor:"pointer",fontSize:12},children:y?"ğŸ™ˆ":"ğŸ‘ï¸"})]})]}),e.jsxs("div",{style:{marginBottom:12},children:[e.jsxs("div",{style:{fontSize:11,color:"#667eea",marginBottom:4,fontWeight:"bold",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("span",{children:["ğŸ–¼ï¸ ì›ë³¸ ì´ë¯¸ì§€ ",w?"(ë…¸ë“œ ì—°ê²°)":p?"(ì—…ë¡œë“œ)":""]}),q&&e.jsx("button",{onClick:u=>{u.stopPropagation(),b(null),h(N=>N.filter(T=>!(T.target===d&&T.targetHandle==="image-in"))),R(null)},style:{background:"transparent",border:"none",color:"#888",cursor:"pointer",fontSize:10,padding:"2px 4px"},title:"ì´ë¯¸ì§€ ì‚­ì œ",children:"âœ•"})]}),e.jsxs("div",{onClick:()=>{var u;return(u=x.current)==null?void 0:u.click()},onDrop:ce,onDragOver:u=>{u.preventDefault(),u.stopPropagation(),u.dataTransfer.dropEffect="copy"},onDragEnter:u=>{u.preventDefault(),u.stopPropagation()},style:{border:`2px dashed ${w?"#10b981":"#667eea"}`,borderRadius:6,padding:12,textAlign:"center",cursor:"pointer",background:q?"transparent":"#2a2a3e",minHeight:80,display:"flex",alignItems:"center",justifyContent:"center",overflow:"hidden"},children:[q?e.jsx("img",{src:q,alt:"source",style:{maxWidth:"100%",maxHeight:100,borderRadius:4,objectFit:"contain"}}):e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:24,marginBottom:4},children:"ğŸ“"}),e.jsx("div",{style:{fontSize:10,color:"#888"},children:"ë…¸ë“œ ì—°ê²° ë˜ëŠ” í´ë¦­í•˜ì—¬ ì—…ë¡œë“œ"})]}),e.jsx("input",{ref:x,type:"file",accept:"image/*",onChange:le,style:{display:"none"}})]})]}),e.jsx("button",{onClick:de,disabled:S||!v||!q,style:{width:"100%",padding:"10px",borderRadius:6,border:"none",background:S?"#555":"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",color:"white",fontWeight:"bold",cursor:S?"wait":"pointer",marginBottom:10,fontSize:13},children:S?"â³ ì²˜ë¦¬ ì¤‘...":"ğŸ­ ë°°ê²½ íˆ¬ëª…í™”"}),S&&e.jsxs("div",{style:{marginBottom:10},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontSize:10,color:"#aaa",marginBottom:4},children:[e.jsx("span",{children:O}),e.jsxs("span",{children:[B,"%"]})]}),e.jsx("div",{style:{width:"100%",height:6,background:"#2a2a3e",borderRadius:3,overflow:"hidden"},children:e.jsx("div",{style:{width:`${B}%`,height:"100%",background:"linear-gradient(90deg, #667eea 0%, #764ba2 50%, #00d4ff 100%)",borderRadius:3,transition:"width 0.3s ease"}})})]}),!S&&O&&e.jsx("div",{style:{padding:"6px 10px",background:O.includes("âœ…")?"#1a3d1a":O.includes("âŒ")?"#3d1a1a":"#2a2a3e",borderRadius:4,fontSize:11,marginBottom:10,textAlign:"center"},children:O}),D&&e.jsxs("div",{style:{overflow:"hidden"},children:[e.jsx("div",{style:{fontSize:11,color:"#00d4ff",marginBottom:4,fontWeight:"bold"},children:"âœ¨ ê²°ê³¼ (íˆ¬ëª… ë°°ê²½)"}),e.jsx("div",{style:{background:"repeating-conic-gradient(#333 0% 25%, #222 0% 50%) 50% / 16px 16px",borderRadius:6,padding:4,overflow:"hidden"},children:e.jsx("img",{src:D,alt:"Transparent",style:{width:"100%",maxHeight:180,objectFit:"contain",borderRadius:4,display:"block"}})}),e.jsx("button",{onClick:()=>{const u=document.createElement("a");u.href=D,u.download=`transparent-${Date.now()}.png`,u.click()},style:{width:"100%",marginTop:6,padding:"6px 10px",borderRadius:4,border:"none",background:"#00d4ff",color:"#000",fontWeight:"bold",cursor:"pointer",fontSize:11},children:"â¬‡ï¸ PNG ë‹¤ìš´ë¡œë“œ"})]})]}),e.jsx(G,{type:"target",position:Z.Left,id:"image-in",style:{background:"#667eea",width:12,height:12}}),e.jsx(G,{type:"source",position:Z.Right,id:"out",style:{background:"#00d4ff",width:12,height:12}})]})}const Bt={image:bt,note:yt,text:vt,shape:kt,board:jt,linkCard:Nt,checklist:Ct,transparentBg:Rt},ge="workspace_data",Fe=()=>({boards:{home:{id:"home",name:"í™ˆ ë³´ë“œ",parentId:null,nodes:[{id:"welcome-note",type:"note",position:{x:250,y:100},data:{content:`í™ˆ ë³´ë“œì— ì˜¤ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤!

ì—¬ê¸°ì„œ ì‘ì—…ì„ ì‹œì‘í•˜ì„¸ìš”.
ìƒˆ ë³´ë“œë¥¼ ë§Œë“¤ì–´ ì •ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.`,backgroundColor:"#fef3c7"}}],edges:[],createdAt:Date.now(),updatedAt:Date.now()}},currentBoardId:"home",tray:[]}),At=()=>{try{const n=localStorage.getItem(ge);if(n){const s=JSON.parse(n);return!s.boards||!s.currentBoardId||!s.boards[s.currentBoardId]?(console.warn("Invalid workspace data, resetting..."),localStorage.removeItem(ge),Fe()):(s.tray||(s.tray=[]),Object.keys(s.boards).forEach(d=>{const o=s.boards[d];Array.isArray(o.nodes)||(o.nodes=[]),Array.isArray(o.edges)||(o.edges=[])}),s)}}catch(n){console.error("Failed to load workspace data:",n),localStorage.removeItem(ge)}return Fe()},zt=n=>{const s={...n};if(s.data&&typeof s.data=="object"){const d={...s.data};Object.keys(d).forEach(o=>{const h=d[o];typeof h=="string"&&h.startsWith("data:image/")&&h.length>1e4&&(d[o]="")}),s.data=d}return s},ue=n=>{try{const s={...n,boards:Object.fromEntries(Object.entries(n.boards).map(([d,o])=>[d,{...o,nodes:o.nodes.map(h=>zt(h))}]))};localStorage.setItem(ge,JSON.stringify(s))}catch(s){if(console.error("Failed to save workspace data:",s),s instanceof DOMException&&s.name==="QuotaExceededError"){console.warn("Storage quota exceeded, clearing old data...");try{const d={...n,boards:{[n.currentBoardId]:n.boards[n.currentBoardId]}};localStorage.setItem(ge,JSON.stringify(d))}catch{localStorage.removeItem(ge)}}}};function Lt(){const[n,s]=r.useState(At),[d,o,h]=lt([]),[f,m,x]=ct([]),v=r.useRef(Date.now()),k=r.useRef(null),y=r.useRef(),I=n.boards[n.currentBoardId],p=n.tray||[],b=r.useCallback(()=>{const j=[];let D=n.currentBoardId;for(;D;){const l=n.boards[D];if(l)j.unshift(l),D=l.parentId;else break}return j},[n]),w=r.useCallback(j=>{const D={...n,boards:{...n.boards,[n.currentBoardId]:{...n.boards[n.currentBoardId],nodes:d,edges:f,updatedAt:Date.now()}},currentBoardId:j};s(D),ue(D)},[n,d,f]),R=r.useCallback((j,D)=>{const l=n.boards[j];if(!l)return;const B={...n.boards,[j]:{...l,name:D,updatedAt:Date.now()}},E=d.map(V=>V.type==="board"&&V.data.boardId===j?{...V,data:{...V.data,name:D}}:V);o(E);const W={...n,boards:B};s(W),ue(W)},[n,d,o]);r.useEffect(()=>{y.current=R},[R]),r.useEffect(()=>{if(k.current!==n.currentBoardId&&(k.current=n.currentBoardId,I)){const j=I.nodes.map(D=>{if(D.type==="board"&&D.data.boardId){const l=n.boards[D.data.boardId],B=l?l.nodes.length:0;return{...D,data:{...D.data,itemCount:B,onNameChange:(E,W)=>{var V;(V=y.current)==null||V.call(y,E,W)}}}}return D});o(j),m(I.edges)}},[n,I,o,m]),r.useEffect(()=>{if(k.current===n.currentBoardId&&I){const j={...n,boards:{...n.boards,[n.currentBoardId]:{...I,nodes:d,edges:f,updatedAt:Date.now()}}};ue(j)}},[d,f]);const S=r.useCallback(j=>{const D={...j,id:`tray-${Date.now()}`,createdAt:Date.now()},l={...n,tray:[...n.tray,D]};s(l),ue(l)},[n]),Y=r.useCallback(j=>{const D={...n,tray:n.tray.filter(l=>l.id!==j)};s(D),ue(D)},[n]),O=r.useCallback(()=>String(v.current++),[]);return{workspaceData:n,setWorkspaceData:s,nodes:d,setNodes:o,onNodesChange:h,edges:f,setEdges:m,onEdgesChange:x,currentBoard:I,trayItems:p,getBreadcrumbs:b,navigateToBoard:w,handleBoardNameChange:R,boardNameChangeRef:y,addToTray:S,removeFromTray:Y,getNewNodeId:O,saveWorkspaceData:()=>ue(n)}}const Wt=[{name:"ë…¸ë‘",color:"#fef3c7"},{name:"íŒŒë‘",color:"#dbeafe"},{name:"ì´ˆë¡",color:"#dcfce7"},{name:"ë¶„í™",color:"#fce7f3"},{name:"ë³´ë¼",color:"#ede9fe"}];class $t extends r.Component{constructor(d){super(d);Ke(this,"handleReset",()=>{localStorage.removeItem("workspace_data"),this.setState({hasError:!1,error:null}),window.location.reload()});this.state={hasError:!1,error:null}}static getDerivedStateFromError(d){return{hasError:!0,error:d}}render(){var d;return this.state.hasError?e.jsxs("div",{className:"workspace-error",children:[e.jsx("h2",{children:"ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ë¡œë“œ ì˜¤ë¥˜"}),e.jsx("p",{children:"ì €ì¥ëœ ë°ì´í„°ì— ë¬¸ì œê°€ ìˆìŠµë‹ˆë‹¤."}),e.jsx("p",{className:"error-detail",children:(d=this.state.error)==null?void 0:d.message}),e.jsx("button",{onClick:this.handleReset,children:"ë°ì´í„° ì´ˆê¸°í™” í›„ ìƒˆë¡œê³ ì¹¨"})]}):this.props.children}}function Ot(){var We,$e,Oe,Pe;const n=ot(),{workspaceData:s,setWorkspaceData:d,nodes:o,setNodes:h,onNodesChange:f,edges:m,setEdges:x,onEdgesChange:v,getBreadcrumbs:k,navigateToBoard:y,boardNameChangeRef:I,getNewNodeId:p}=Lt(),[b,w]=r.useState(!1),[R,S]=r.useState("select"),[Y,O]=r.useState(!0),[j,D]=r.useState(240),[l,B]=r.useState(null),[E,W]=r.useState([]),[V,q]=r.useState([{id:"default",name:"ì „ì²´",color:"#3b82f6"},{id:"character",name:"ìºë¦­í„°",color:"#8b5cf6"},{id:"background",name:"ë°°ê²½",color:"#10b981"},{id:"prop",name:"ì†Œí’ˆ",color:"#f59e0b"}]),[P,se]=r.useState("default"),[ne,le]=r.useState(!1),[ce,de]=r.useState(""),[u,N]=r.useState(null),[T,$]=r.useState(null),[te,ae]=r.useState(1),K=r.useRef(null),re=ie();r.useEffect(()=>{const t=a=>{const{url:c,prompt:i,timestamp:g,category:C}=a.detail;console.log("[Workspace] asset-add ì´ë²¤íŠ¸ ìˆ˜ì‹ :",c==null?void 0:c.slice(0,50)),W(L=>[{id:`asset-${g}`,url:c,prompt:i,timestamp:g,category:C||"default"},...L].slice(0,50))};return window.addEventListener("asset-add",t),console.log("[Workspace] asset-add ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡"),()=>window.removeEventListener("asset-add",t)},[]),r.useEffect(()=>{const t=()=>N(null);if(u)return window.addEventListener("click",t),()=>window.removeEventListener("click",t)},[u]);const xe=r.useCallback(t=>{const a={ì „ì²´:t,"ìºë¦­í„° ìƒì„¸":"",ë¨¸ë¦¬ì¹´ë½:"",ì˜ìƒ:"",ì•…ì„¸ì„œë¦¬:"",ë¬´ê¸°:"","ì•„íŠ¸ ìŠ¤íƒ€ì¼":"",ë°°ê²½:""},c=t.match(/Character Details:\n([\s\S]*?)(?=\n\nHair:|$)/);c&&(a["ìºë¦­í„° ìƒì„¸"]=c[1].trim());const i=t.match(/Hair:\s*([^\n]+)/);i&&(a.ë¨¸ë¦¬ì¹´ë½=i[1].trim());const g=t.match(/Outfit:\s*([^\n]+)/);g&&(a.ì˜ìƒ=g[1].trim());const C=t.match(/Accessories:\s*([^\n]+)/);C&&(a.ì•…ì„¸ì„œë¦¬=C[1].trim());const L=t.match(/Weapon:\s*([^\n]+)/);L&&(a.ë¬´ê¸°=L[1].trim());const A=t.match(/Art Style:\s*([^\n]+)/);A&&(a["ì•„íŠ¸ ìŠ¤íƒ€ì¼"]=A[1].trim());const _=t.match(/Background:\s*([^\n]+)/);return _&&(a.ë°°ê²½=_[1].trim()),a},[]),pe=r.useRef([]),Q=r.useRef(-1),[De,ve]=r.useState(!1),[Se,we]=r.useState(!1),be=r.useRef(!1),[ke,Xe]=r.useState([]),Je=r.useCallback((t,a)=>{if(be.current){be.current=!1;return}const c={nodes:JSON.parse(JSON.stringify(t)),edges:JSON.parse(JSON.stringify(a))},i=pe.current.slice(0,Q.current+1);pe.current=[...i,c].slice(-50),Q.current=Math.min(Q.current+1,49),ve(Q.current>0),we(!1)},[]),je=r.useCallback(()=>{if(Q.current>0){be.current=!0,Q.current-=1;const t=pe.current[Q.current];t&&(h(t.nodes),x(t.edges)),ve(Q.current>0),we(!0)}},[h,x]),Ne=r.useCallback(()=>{if(Q.current<pe.current.length-1){be.current=!0,Q.current+=1;const t=pe.current[Q.current];t&&(h(t.nodes),x(t.edges)),ve(!0),we(Q.current<pe.current.length-1)}},[h,x]),Ee=r.useCallback(()=>{const t=o.filter(a=>a.selected);t.length>0&&Xe(JSON.parse(JSON.stringify(t)))},[o]),Ie=r.useCallback(()=>{if(ke.length===0)return;const t=ke.map(a=>({...a,id:p(),position:{x:a.position.x+50,y:a.position.y+50},selected:!0}));h(a=>[...a.map(i=>({...i,selected:!1})),...t])},[ke,p,h]),Me=r.useCallback(()=>{const t=o.filter(g=>g.selected);if(t.length<2)return;const a=20,c=[...t].sort((g,C)=>g.position.y-C.position.y),i=c[0];h(g=>{const C=i.position.x;let L=i.position.y;return g.map(A=>{var z;if(c.findIndex(U=>U.id===A.id)!==-1){const U=L;return L+=(((z=A.style)==null?void 0:z.height)||150)+a,{...A,position:{x:C,y:U}}}return A})})},[o,h]),Te=r.useCallback(()=>{const t=o.filter(g=>g.selected);if(t.length<2)return;const a=20,c=[...t].sort((g,C)=>g.position.x-C.position.x),i=c[0];h(g=>{const C=i.position.y;let L=i.position.x;return g.map(A=>{var z;if(c.findIndex(U=>U.id===A.id)!==-1){const U=L;return L+=(((z=A.style)==null?void 0:z.width)||200)+a,{...A,position:{x:U,y:C}}}return A})})},[o,h]),Re=r.useCallback(()=>{const t=o.filter(M=>M.selected);if(t.length<2)return;const a=5,c=15,i=[...t].sort((M,H)=>{const F=Math.floor(M.position.y/100),J=Math.floor(H.position.y/100);return F!==J?F-J:M.position.x-H.position.x}),g=i[0],C=g.position.x,L=g.position.y,A=M=>{var H,F;if((H=M.style)!=null&&H.width&&((F=M.style)!=null&&F.height))return{width:M.style.width,height:M.style.height};switch(M.type){case"image":return{width:200,height:200};case"note":return{width:180,height:120};case"text":return{width:150,height:40};case"shape":return{width:100,height:100};default:return{width:200,height:150}}},_=i.map(M=>({node:M,size:A(M)})),z=Math.ceil(i.length/a),U=[];for(let M=0;M<z;M++){const H=_.slice(M*a,(M+1)*a),F=Math.max(...H.map(J=>J.size.height));U.push(F)}const ee=[];for(let M=0;M<a;M++){const H=_.filter((F,J)=>J%a===M);if(H.length>0){const F=Math.max(...H.map(J=>J.size.width));ee.push(F)}}h(M=>M.map(H=>{const F=i.findIndex(J=>J.id===H.id);if(F!==-1){const J=F%a,fe=Math.floor(F/a);let oe=C;for(let he=0;he<J;he++)oe+=ee[he]+c;let ye=L;for(let he=0;he<fe;he++)ye+=U[he]+c;return{...H,position:{x:oe,y:ye}}}return H}))},[o,h]);r.useEffect(()=>{const t=a=>{if(!(a.target instanceof HTMLInputElement||a.target instanceof HTMLTextAreaElement)){if((a.ctrlKey||a.metaKey)&&a.key==="z"&&!a.shiftKey&&(a.preventDefault(),je()),((a.ctrlKey||a.metaKey)&&a.shiftKey&&a.key==="z"||(a.ctrlKey||a.metaKey)&&a.key==="y")&&(a.preventDefault(),Ne()),(a.ctrlKey||a.metaKey)&&a.key==="c"&&(a.preventDefault(),Ee()),(a.ctrlKey||a.metaKey)&&a.key==="v"&&(a.preventDefault(),Ie()),(a.ctrlKey||a.metaKey)&&a.key==="a"&&(a.preventDefault(),h(c=>c.map(i=>({...i,selected:!0})))),a.key==="Delete"||a.key==="Backspace"){a.preventDefault();const c=o.filter(i=>i.selected).map(i=>i.id);c.length>0&&(h(i=>i.filter(g=>!g.selected)),x(i=>i.filter(g=>!c.includes(g.source)&&!c.includes(g.target))))}a.key==="Escape"&&(a.preventDefault(),T?$(null):(h(c=>c.map(i=>({...i,selected:!1}))),w(!1))),a.key==="l"&&!a.ctrlKey&&!a.metaKey&&(a.preventDefault(),O(c=>!c)),a.key==="n"&&!a.ctrlKey&&!a.metaKey&&(a.preventDefault(),w(c=>!c))}};return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)},[je,Ne,Ee,Ie,h,x,o,T]);const Be=r.useRef("");r.useEffect(()=>{const t=setTimeout(()=>{const a=JSON.stringify({n:o.length,e:m.length});a!==Be.current&&(o.length>0||m.length>0)&&(Be.current=a,Je(o,m))},1e3);return()=>clearTimeout(t)},[o.length,m.length]);const Ve=r.useCallback(t=>x(a=>ht(t,a)),[x]),Ae=r.useCallback((t,a)=>{const c={x:Math.random()*400+100,y:Math.random()*300+100},i={id:p(),type:"image",position:c,data:{imageUrl:t,label:a,width:200,height:200},style:{width:200,height:200}};h(g=>[...g,i])},[h,p]),_e=r.useCallback(t=>{t.preventDefault();const a=t.dataTransfer.effectAllowed;a==="move"||a==="copyMove"?t.dataTransfer.dropEffect="move":t.dataTransfer.dropEffect="copy"},[]),qe=r.useCallback(t=>{var _;if(t.preventDefault(),!K.current)return;const a=K.current.getBoundingClientRect(),c=re.screenToFlowPosition({x:t.clientX-a.left,y:t.clientY-a.top}),i=t.dataTransfer.files;if(i&&i.length>0){const z=Array.from(i).filter(ee=>ee.type.startsWith("image/")),U=z.slice(0,10);if(z.length>10&&alert(`ì´ë¯¸ì§€ëŠ” í•œ ë²ˆì— ìµœëŒ€ 10ê°œê¹Œì§€ë§Œ ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
${z.length}ê°œ ì¤‘ 10ê°œë§Œ ì¶”ê°€ë©ë‹ˆë‹¤.`),U.length>0){U.forEach((ee,M)=>{const H=new FileReader;H.onload=F=>{var oe;const J=(oe=F.target)==null?void 0:oe.result,fe={id:p(),type:"image",position:{x:c.x+M%5*220,y:c.y+Math.floor(M/5)*220},data:{imageUrl:J,label:ee.name.slice(0,20)||"ì—…ë¡œë“œ ì´ë¯¸ì§€"},style:{width:200,height:200}};h(ye=>[...ye,fe])},H.readAsDataURL(ee)});return}}const g=t.dataTransfer.getData("application/json")||t.dataTransfer.getData("text/plain");if(g)try{const z=JSON.parse(g);if(z.type==="asset"&&z.url){const U={id:p(),type:"image",position:c,data:{imageUrl:z.url,label:((_=z.prompt)==null?void 0:_.slice(0,20))||"AI ìƒì„±",prompt:z.prompt},style:{width:200,height:200}};h(ee=>[...ee,U]);return}}catch{}const C=t.dataTransfer.getData("application/reactflow-type"),L=t.dataTransfer.getData("application/reactflow-data");if(!C)return;let A;switch(C){case"note":const z=L||"#fef3c7";A={id:p(),type:"note",position:c,data:{content:`ìƒˆ ë…¸íŠ¸

ë”ë¸”í´ë¦­í•˜ì—¬ í¸ì§‘`,backgroundColor:z},style:{width:200,height:150}};break;case"text":A={id:p(),type:"text",position:c,data:{text:"í…ìŠ¤íŠ¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”",fontSize:16,color:"#374151"},style:{width:150,height:50}};break;case"shape":const[U,ee]=(L||"rectangle,#3b82f6").split(",");A={id:p(),type:"shape",position:c,data:{shape:U,backgroundColor:ee,width:100,height:100},style:{width:100,height:100}};break;case"board":const M=`board-${p()}`,H={id:M,name:"",parentId:s.currentBoardId,nodes:[],edges:[],createdAt:Date.now(),updatedAt:Date.now()};A={id:`node-${M}`,type:"board",position:c,data:{boardId:M,name:"",itemCount:0,onNameChange:(J,fe)=>{var oe;(oe=I.current)==null||oe.call(I,J,fe)}}};const F={...s,boards:{...s.boards,[M]:H}};d(F),ue(F);break;case"transparentBg":A={id:p(),type:"transparentBg",position:c,data:{},style:{width:400,height:580}};break;case"linkCard":A={id:p(),type:"linkCard",position:c,data:{url:"",title:"",favicon:""},style:{width:280,height:120}};break;case"checklist":A={id:p(),type:"checklist",position:c,data:{title:"ì²´í¬ë¦¬ìŠ¤íŠ¸",items:[]},style:{width:250,height:200}};break;default:return}h(z=>[...z,A]),w(!1)},[re,s,h,d,Ae,p,I]),Ge=r.useCallback((t,a)=>{a.type==="board"&&a.data.boardId?y(a.data.boardId):a.type==="image"&&a.data.imageUrl&&$({url:a.data.imageUrl,prompt:a.data.prompt||a.data.label})},[y]),Ze=r.useCallback(()=>{h(t=>t.filter(a=>!a.selected)),x(t=>t.filter(a=>!a.selected))},[h,x]),Qe=r.useCallback(t=>{if(t.preventDefault(),!K.current)return;const a=K.current.getBoundingClientRect();re.screenToFlowPosition({x:t.clientX-a.left,y:t.clientY-a.top}),B({x:t.clientX,y:t.clientY,type:"canvas",nodeData:{imageUrl:void 0,prompt:void 0}})},[re]),et=r.useCallback(t=>{t.preventDefault(),t.stopPropagation(),B({x:t.clientX,y:t.clientY,type:"canvas",nodeData:{imageUrl:void 0,prompt:void 0}})},[]),tt=r.useCallback((t,a)=>{var c,i,g,C,L;t.preventDefault(),t.stopPropagation(),B({x:t.clientX,y:t.clientY,type:"node",nodeId:a.id,nodeData:{imageUrl:((c=a.data)==null?void 0:c.imageUrl)||((i=a.data)==null?void 0:i.resultImage)||((g=a.data)==null?void 0:g.generatedImage),prompt:((C=a.data)==null?void 0:C.prompt)||((L=a.data)==null?void 0:L.label)}})},[]),X=r.useCallback(()=>{B(null)},[]),at=r.useCallback(()=>{l!=null&&l.nodeId&&(h(t=>t.filter(a=>a.id!==l.nodeId)),x(t=>t.filter(a=>a.source!==l.nodeId&&a.target!==l.nodeId))),X()},[l,h,x,X]),ze=r.useCallback(()=>{var c;const a=o.filter(i=>i.selected).filter(i=>{var g;return(g=i.data)==null?void 0:g.imageUrl});if(a.length>0){const i=a.map((g,C)=>({id:`asset-${Date.now()}-${C}`,url:g.data.imageUrl,prompt:g.data.prompt||"í™”ì´íŠ¸ë³´ë“œì—ì„œ ì¶”ê°€",timestamp:Date.now()+C,category:P==="default"?"default":P}));W(g=>[...i,...g].slice(0,50))}else(c=l==null?void 0:l.nodeData)!=null&&c.imageUrl&&W(i=>{var g;return[{id:`asset-${Date.now()}`,url:l.nodeData.imageUrl,prompt:((g=l.nodeData)==null?void 0:g.prompt)||"í™”ì´íŠ¸ë³´ë“œì—ì„œ ì¶”ê°€",timestamp:Date.now(),category:P==="default"?"default":P},...i].slice(0,50)});X()},[l,P,X,o]),st=r.useCallback(()=>{var t;(t=l==null?void 0:l.nodeData)!=null&&t.prompt&&navigator.clipboard.writeText(l.nodeData.prompt).then(()=>{var a;console.log("í”„ë¡¬í”„íŠ¸ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤:",(a=l.nodeData)==null?void 0:a.prompt)}).catch(a=>{console.error("ë³µì‚¬ ì‹¤íŒ¨:",a)}),X()},[l,X]),Ce=r.useCallback(t=>{if(!K.current||!l)return;const a=K.current.getBoundingClientRect(),c=re.screenToFlowPosition({x:l.x-a.left,y:l.y-a.top});let i;switch(t){case"note":i={id:p(),type:"note",position:c,data:{content:`ìƒˆ ë…¸íŠ¸

ë”ë¸”í´ë¦­í•˜ì—¬ í¸ì§‘`,backgroundColor:"#fef3c7"},style:{width:200,height:150}};break;case"text":i={id:p(),type:"text",position:c,data:{text:"í…ìŠ¤íŠ¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”",fontSize:16,color:"#374151"},style:{width:150,height:50}};break;case"transparentBg":i={id:p(),type:"transparentBg",position:c,data:{},style:{width:400,height:580}};break;default:X();return}h(g=>[...g,i]),X()},[l,re,p,Ae,h,X]);r.useEffect(()=>{const t=()=>X();return window.addEventListener("click",t),()=>window.removeEventListener("click",t)},[X]);const Le=k();return e.jsxs("div",{className:"workspace-container",children:[e.jsxs("div",{className:"toolbar",children:[e.jsx("button",{className:"toolbar-group-button exit-button","data-tooltip":"ë‚˜ê°€ê¸°",onClick:()=>n("/workspace"),children:e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M15 18l-6-6 6-6"})})}),e.jsx("div",{className:"toolbar-divider"}),e.jsx("button",{className:`toolbar-group-button ${R==="select"?"active":""}`,"data-tooltip":"ì„ íƒ",onClick:()=>S("select"),children:e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M3 3l7.07 16.97 2.51-7.39 7.39-2.51L3 3z"})})}),e.jsx("button",{className:`toolbar-group-button ${b?"active":""}`,"data-tooltip":"ë„êµ¬ ì¶”ê°€",onClick:()=>w(!b),children:e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M12 5v14M5 12h14"})})}),e.jsx("div",{className:"toolbar-divider"}),e.jsx("button",{className:`toolbar-group-button ${De?"":"disabled"}`,"data-tooltip":"ì‹¤í–‰ì·¨ì†Œ (Ctrl+Z)",onClick:je,disabled:!De,children:e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M3 10h10a5 5 0 015 5v2M3 10l5-5M3 10l5 5"})})}),e.jsx("button",{className:`toolbar-group-button ${Se?"":"disabled"}`,"data-tooltip":"ë‹¤ì‹œì‹¤í–‰ (Ctrl+Y)",onClick:Ne,disabled:!Se,children:e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M21 10H11a5 5 0 00-5 5v2M21 10l-5-5M21 10l-5 5"})})}),e.jsx("div",{className:"toolbar-divider"}),e.jsx("button",{className:"toolbar-group-button delete-button","data-tooltip":"ì‚­ì œ",onClick:Ze,children:e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"})})})]}),e.jsx("div",{className:"workspace-header",children:e.jsx("nav",{className:"breadcrumb",children:Le.map((t,a)=>e.jsxs("div",{className:"breadcrumb-item",children:[a>0&&e.jsx("span",{className:"breadcrumb-separator",children:"â€º"}),e.jsxs("button",{className:`breadcrumb-link ${a===Le.length-1?"active":""}`,onClick:()=>y(t.id),children:[a===0&&e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z"})}),t.name||"í™ˆ"]})]},t.id))})}),b&&e.jsxs("div",{className:"add-panel",children:[e.jsxs("div",{className:"add-panel-header",children:[e.jsx("h3",{children:"ë„êµ¬ (ë“œë˜ê·¸í•˜ì—¬ ë°°ì¹˜)"}),e.jsx("button",{className:"add-panel-close",onClick:()=>w(!1),children:"Ã—"})]}),e.jsxs("div",{className:"add-panel-content add-panel-scrollable",children:[e.jsxs("div",{className:"add-section",children:[e.jsx("h4",{children:"ë„êµ¬"}),e.jsx("div",{className:"draggable-items",children:e.jsxs("div",{className:"draggable-item transparent-bg-drag",draggable:!0,onDragStart:t=>{t.dataTransfer.setData("application/reactflow-type","transparentBg"),t.dataTransfer.effectAllowed="move"},children:[e.jsx("span",{className:"drag-icon",children:"ğŸ­"}),e.jsx("span",{children:"íˆ¬ëª… ë°°ê²½ ìƒì„±ê¸°"})]})})]}),e.jsxs("div",{className:"add-section",children:[e.jsx("h4",{children:"ë³´ë“œ"}),e.jsxs("div",{className:"draggable-item board-drag",draggable:!0,onDragStart:t=>{t.dataTransfer.setData("application/reactflow-type","board"),t.dataTransfer.effectAllowed="move"},children:[e.jsx("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"})}),e.jsx("span",{children:"ìƒˆ ë³´ë“œ"})]})]}),e.jsxs("div",{className:"add-section",children:[e.jsx("h4",{children:"ë…¸íŠ¸"}),e.jsx("div",{className:"add-color-grid",children:Wt.map(t=>e.jsx("div",{className:"draggable-color-btn",style:{backgroundColor:t.color},title:t.name,draggable:!0,onDragStart:a=>{a.dataTransfer.setData("application/reactflow-type","note"),a.dataTransfer.setData("application/reactflow-data",t.color),a.dataTransfer.effectAllowed="move"}},t.color))})]}),e.jsxs("div",{className:"add-section",children:[e.jsx("h4",{children:"í…ìŠ¤íŠ¸"}),e.jsxs("div",{className:"draggable-item text-drag",draggable:!0,onDragStart:t=>{t.dataTransfer.setData("application/reactflow-type","text"),t.dataTransfer.effectAllowed="move"},children:[e.jsx("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M4 7V4h16v3M9 20h6M12 4v16"})}),e.jsx("span",{children:"í…ìŠ¤íŠ¸"})]})]}),e.jsxs("div",{className:"add-section",children:[e.jsx("h4",{children:"ìœ í‹¸ë¦¬í‹°"}),e.jsxs("div",{className:"draggable-items",children:[e.jsxs("div",{className:"draggable-item link-card-drag",draggable:!0,onDragStart:t=>{t.dataTransfer.setData("application/reactflow-type","linkCard"),t.dataTransfer.effectAllowed="move"},children:[e.jsx("span",{className:"drag-icon",children:"ğŸ”—"}),e.jsx("span",{children:"ë§í¬ ì¹´ë“œ"})]}),e.jsxs("div",{className:"draggable-item checklist-drag",draggable:!0,onDragStart:t=>{t.dataTransfer.setData("application/reactflow-type","checklist"),t.dataTransfer.effectAllowed="move"},children:[e.jsx("span",{className:"drag-icon",children:"â˜‘ï¸"}),e.jsx("span",{children:"ì²´í¬ë¦¬ìŠ¤íŠ¸"})]})]})]}),e.jsxs("div",{className:"add-section",children:[e.jsx("h4",{children:"ë„í˜•"}),e.jsxs("div",{className:"add-shape-grid",children:[e.jsx("div",{className:"draggable-shape-btn",title:"ì‚¬ê°í˜•",draggable:!0,onDragStart:t=>{t.dataTransfer.setData("application/reactflow-type","shape"),t.dataTransfer.setData("application/reactflow-data","rectangle,#3b82f6"),t.dataTransfer.effectAllowed="move"},children:e.jsx("div",{className:"shape-preview shape-rect"})}),e.jsx("div",{className:"draggable-shape-btn",title:"ì›",draggable:!0,onDragStart:t=>{t.dataTransfer.setData("application/reactflow-type","shape"),t.dataTransfer.setData("application/reactflow-data","circle,#22c55e"),t.dataTransfer.effectAllowed="move"},children:e.jsx("div",{className:"shape-preview shape-circle"})}),e.jsx("div",{className:"draggable-shape-btn",title:"ì‚¼ê°í˜•",draggable:!0,onDragStart:t=>{t.dataTransfer.setData("application/reactflow-type","shape"),t.dataTransfer.setData("application/reactflow-data","triangle,#eab308"),t.dataTransfer.effectAllowed="move"},children:e.jsx("div",{className:"shape-preview shape-triangle"})})]})]})]})]}),e.jsx("div",{className:"react-flow-canvas",ref:K,children:e.jsxs(ut,{nodes:o,edges:m,onNodesChange:f,onEdgesChange:v,onConnect:Ve,onDragOver:_e,onDrop:qe,onNodeDoubleClick:Ge,onPaneContextMenu:Qe,onNodeContextMenu:tt,onSelectionContextMenu:et,onMove:(t,a)=>ae(a.zoom),nodeTypes:Bt,fitView:!0,minZoom:.05,maxZoom:4,deleteKeyCode:["Backspace","Delete"],selectionOnDrag:!0,selectionMode:pt.Partial,panOnDrag:[1,2],selectNodesOnDrag:!0,children:[e.jsx(gt,{variant:mt.Dots,gap:20,size:1,color:"#e5e7eb"}),e.jsx(ft,{}),e.jsx(xt,{}),e.jsxs("div",{className:"zoom-indicator",children:[Math.round(te*100),"%"]})]})}),l&&e.jsx("div",{className:"context-menu",style:{position:"fixed",left:l.x,top:l.y,zIndex:1e3,background:"#1a1a2e",border:"1px solid #444",borderRadius:8,padding:4,boxShadow:"0 4px 12px rgba(0, 0, 0, 0.3)",minWidth:160},onClick:t=>t.stopPropagation(),children:l.type==="canvas"?e.jsxs(e.Fragment,{children:[o.filter(t=>{var a;return t.selected&&((a=t.data)==null?void 0:a.imageUrl)}).length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"context-menu-item",onClick:ze,children:["ğŸ“š ë¼ì´ë¸ŒëŸ¬ë¦¬ì— ì¶”ê°€ (",o.filter(t=>{var a;return t.selected&&((a=t.data)==null?void 0:a.imageUrl)}).length,"ê°œ)"]}),e.jsx("div",{className:"context-menu-divider"})]}),o.filter(t=>t.selected).length>=2&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"context-menu-submenu-title",children:"ì •ë ¬"}),e.jsx("div",{className:"context-menu-item",onClick:()=>{Me(),X()},children:"â¬‡ï¸ ì„¸ë¡œ ì •ë ¬"}),e.jsx("div",{className:"context-menu-item",onClick:()=>{Te(),X()},children:"â¡ï¸ ê°€ë¡œ ì •ë ¬"}),e.jsx("div",{className:"context-menu-item",onClick:()=>{Re(),X()},children:"âŠ ê·¸ë¦¬ë“œ ì •ë ¬"}),e.jsx("div",{className:"context-menu-divider"})]}),e.jsx("div",{className:"context-menu-submenu-title",children:"ë…¸ë“œ ì¶”ê°€"}),e.jsx("div",{className:"context-menu-item",onClick:()=>Ce("transparentBg"),children:"ğŸ­ íˆ¬ëª… ë°°ê²½ ìƒì„±ê¸°"}),e.jsx("div",{className:"context-menu-divider"}),e.jsx("div",{className:"context-menu-item",onClick:()=>Ce("note"),children:"ğŸ“ ë…¸íŠ¸"}),e.jsx("div",{className:"context-menu-item",onClick:()=>Ce("text"),children:"ğŸ“„ í…ìŠ¤íŠ¸"})]}):e.jsxs(e.Fragment,{children:[(o.filter(t=>{var a;return t.selected&&((a=t.data)==null?void 0:a.imageUrl)}).length>0||((We=l.nodeData)==null?void 0:We.imageUrl))&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"context-menu-item",onClick:ze,children:["ğŸ“š ë¼ì´ë¸ŒëŸ¬ë¦¬ì— ì¶”ê°€ ",o.filter(t=>{var a;return t.selected&&((a=t.data)==null?void 0:a.imageUrl)}).length>1?`(${o.filter(t=>{var a;return t.selected&&((a=t.data)==null?void 0:a.imageUrl)}).length}ê°œ)`:""]})}),(($e=l.nodeData)==null?void 0:$e.prompt)&&e.jsx("div",{className:"context-menu-item",onClick:st,children:"ğŸ“‹ í”„ë¡¬í”„íŠ¸ ë³µì‚¬"}),(((Oe=l.nodeData)==null?void 0:Oe.imageUrl)||((Pe=l.nodeData)==null?void 0:Pe.prompt))&&e.jsx("div",{className:"context-menu-divider"}),e.jsx("div",{className:"context-menu-submenu-title",children:"ì •ë ¬"}),e.jsx("div",{className:"context-menu-item",onClick:()=>{Me(),X()},children:"â¬‡ï¸ ì„¸ë¡œ ì •ë ¬"}),e.jsx("div",{className:"context-menu-item",onClick:()=>{Te(),X()},children:"â¡ï¸ ê°€ë¡œ ì •ë ¬"}),e.jsx("div",{className:"context-menu-item",onClick:()=>{Re(),X()},children:"âŠ ê·¸ë¦¬ë“œ ì •ë ¬"}),e.jsx("div",{className:"context-menu-divider"}),e.jsx("div",{className:"context-menu-item context-menu-delete",onClick:at,children:"ğŸ—‘ï¸ ì‚­ì œ"})]})}),u&&e.jsxs("div",{className:"context-menu",style:{position:"fixed",left:u.x,top:u.y,zIndex:1e4,background:"#1a1a2e",border:"1px solid #444",borderRadius:8,padding:4,boxShadow:"0 4px 12px rgba(0, 0, 0, 0.4)",minWidth:180,maxHeight:400,overflowY:"auto"},onClick:t=>t.stopPropagation(),children:[e.jsx("div",{style:{padding:"6px 10px",fontSize:11,color:"#888",borderBottom:"1px solid #333"},children:"ğŸ“‹ í”„ë¡¬í”„íŠ¸ ë³µì‚¬"}),Object.entries(xe(u.asset.prompt)).map(([t,a])=>a?e.jsxs("div",{className:"context-menu-item",style:{padding:"8px 12px",cursor:"pointer",fontSize:12,color:"#e0e0e0",display:"flex",alignItems:"center",gap:8},onClick:()=>{navigator.clipboard.writeText(a),N(null),console.log(`[${t}] ë³µì‚¬ë¨:`,a.slice(0,50)+"...")},children:[e.jsx("span",{style:{color:t==="ì „ì²´"?"#4ade80":"#94a3b8"},children:t==="ì „ì²´"?"ğŸ“„":t==="ìºë¦­í„° ìƒì„¸"?"ğŸ‘¤":t==="ë¨¸ë¦¬ì¹´ë½"?"ğŸ’‡":t==="ì˜ìƒ"?"ğŸ‘•":t==="ì•…ì„¸ì„œë¦¬"?"ğŸ’":t==="ë¬´ê¸°"?"âš”ï¸":t==="ì•„íŠ¸ ìŠ¤íƒ€ì¼"?"ğŸ¨":t==="ë°°ê²½"?"ğŸ–¼ï¸":"ğŸ“"}),e.jsx("span",{children:t})]},t):null),e.jsxs("div",{style:{borderTop:"1px solid #333",marginTop:4,paddingTop:4},children:[e.jsxs("div",{className:"context-menu-item",style:{padding:"8px 12px",cursor:"pointer",fontSize:12,color:"#e0e0e0",display:"flex",alignItems:"center",gap:8},onClick:()=>{const t=document.createElement("a");t.href=u.asset.url,t.download=`asset-${u.asset.timestamp}.png`,t.click(),N(null)},children:[e.jsx("span",{children:"â¬‡ï¸"}),e.jsx("span",{children:"ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ"})]}),e.jsxs("div",{className:"context-menu-item context-menu-delete",style:{padding:"8px 12px",cursor:"pointer",fontSize:12,color:"#ef4444",display:"flex",alignItems:"center",gap:8},onClick:()=>{W(t=>t.filter(a=>a.id!==u.asset.id)),N(null)},children:[e.jsx("span",{children:"ğŸ—‘ï¸"}),e.jsx("span",{children:"ì‚­ì œ"})]})]})]}),T&&e.jsx("div",{className:"image-popup-overlay",onClick:()=>$(null),children:e.jsxs("div",{className:"image-popup-content",onClick:t=>t.stopPropagation(),children:[e.jsx("button",{className:"image-popup-close",onClick:()=>$(null),title:"ë‹«ê¸° (ESC)",children:"Ã—"}),e.jsx("img",{src:T.url,alt:"ì´ë¯¸ì§€"}),T.prompt&&e.jsxs("div",{className:"image-popup-prompt",children:[e.jsx("span",{children:T.prompt}),e.jsx("button",{onClick:()=>{navigator.clipboard.writeText(T.prompt||""),alert("í”„ë¡¬í”„íŠ¸ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!")},title:"í”„ë¡¬í”„íŠ¸ ë³µì‚¬",children:"ğŸ“‹"})]}),e.jsx("div",{className:"image-popup-actions",children:e.jsx("button",{onClick:()=>{const t=document.createElement("a");t.href=T.url,t.download=`image-${Date.now()}.png`,t.click()},children:"â¬‡ï¸ ë‹¤ìš´ë¡œë“œ"})})]})}),e.jsxs("div",{className:`asset-sidebar ${Y?"open":""}`,style:Y?{width:j}:void 0,children:[Y&&e.jsx("div",{className:"library-resize-handle",onMouseDown:t=>{t.preventDefault();const a=t.clientX,c=j,i=C=>{const L=Math.max(180,Math.min(500,c-(C.clientX-a)));D(L)},g=()=>{document.removeEventListener("mousemove",i),document.removeEventListener("mouseup",g)};document.addEventListener("mousemove",i),document.addEventListener("mouseup",g)}}),e.jsxs("div",{className:"asset-sidebar-header",children:[e.jsxs("h3",{children:["ğŸ“š ë¼ì´ë¸ŒëŸ¬ë¦¬ (",E.length,")"]}),e.jsx("button",{onClick:()=>O(!Y),children:Y?"â†’":"â†"})]}),Y&&e.jsxs("div",{className:"asset-sidebar-content",children:[e.jsxs("div",{className:"library-category-tabs",children:[V.map(t=>e.jsx("button",{className:`library-category-tab ${P===t.id?"active":""}`,style:{"--cat-color":t.color},onClick:()=>se(t.id),children:t.name},t.id)),e.jsx("button",{className:"library-category-add",onClick:()=>le(!0),title:"ìƒˆ ì¹´í…Œê³ ë¦¬ ì¶”ê°€",children:"+"})]}),ne&&e.jsxs("div",{className:"library-category-input",children:[e.jsx("input",{type:"text",value:ce,onChange:t=>de(t.target.value),placeholder:"ì¹´í…Œê³ ë¦¬ ì´ë¦„",autoFocus:!0,onKeyDown:t=>{if(t.key==="Enter"&&ce.trim()){const a=["#ec4899","#06b6d4","#84cc16","#f97316","#6366f1"];q(c=>[...c,{id:`cat-${Date.now()}`,name:ce.trim(),color:a[c.length%a.length]}]),de(""),le(!1)}else t.key==="Escape"&&(de(""),le(!1))}}),e.jsx("button",{onClick:()=>{if(ce.trim()){const t=["#ec4899","#06b6d4","#84cc16","#f97316","#6366f1"];q(a=>[...a,{id:`cat-${Date.now()}`,name:ce.trim(),color:t[a.length%t.length]}]),de(""),le(!1)}},children:"âœ“"}),e.jsx("button",{onClick:()=>{de(""),le(!1)},children:"âœ•"})]}),e.jsxs("div",{className:"asset-upload-zone",onDragOver:t=>{t.preventDefault(),t.currentTarget.classList.add("dragging")},onDragLeave:t=>{t.currentTarget.classList.remove("dragging")},onDrop:t=>{t.preventDefault(),t.currentTarget.classList.remove("dragging");const a=t.dataTransfer.files;if(a&&a.length>0){const c=Array.from(a).filter(g=>g.type.startsWith("image/")),i=c.slice(0,10);c.length>10&&alert(`ì´ë¯¸ì§€ëŠ” í•œ ë²ˆì— ìµœëŒ€ 10ê°œê¹Œì§€ë§Œ ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
${c.length}ê°œ ì¤‘ 10ê°œë§Œ ì¶”ê°€ë©ë‹ˆë‹¤.`),i.forEach((g,C)=>{const L=new FileReader;L.onload=A=>{var z;const _=(z=A.target)==null?void 0:z.result;W(U=>[{id:`asset-${Date.now()}-${C}`,url:_,prompt:"ì—…ë¡œë“œëœ ì´ë¯¸ì§€",timestamp:Date.now(),category:P==="default"?"default":P},...U].slice(0,50))},L.readAsDataURL(g)})}},onClick:()=>{const t=document.createElement("input");t.type="file",t.accept="image/*",t.multiple=!0,t.onchange=a=>{const c=a.target.files;c&&Array.from(c).forEach((i,g)=>{const C=new FileReader;C.onload=L=>{var _;const A=(_=L.target)==null?void 0:_.result;W(z=>[{id:`asset-${Date.now()}-${g}`,url:A,prompt:"ì—…ë¡œë“œëœ ì´ë¯¸ì§€",timestamp:Date.now(),category:P==="default"?"default":P},...z].slice(0,50))},C.readAsDataURL(i)})},t.click()},children:[e.jsx("span",{children:"ğŸ“ ì´ë¯¸ì§€ ì—…ë¡œë“œ"}),e.jsx("span",{className:"upload-hint",children:"í´ë¦­ ë˜ëŠ” ë“œë˜ê·¸ (ë‹¤ì¤‘ ì„ íƒ ê°€ëŠ¥)"})]}),(()=>{var a;const t=P==="default"?E:E.filter(c=>c.category===P);return t.length===0?e.jsx("div",{className:"asset-sidebar-empty",children:e.jsx("p",{children:P==="default"?`ìƒì„±ëœ ì´ë¯¸ì§€ê°€
ì—¬ê¸°ì— ì €ì¥ë©ë‹ˆë‹¤`:`'${(a=V.find(c=>c.id===P))==null?void 0:a.name}' ì¹´í…Œê³ ë¦¬ê°€
ë¹„ì–´ìˆìŠµë‹ˆë‹¤`})}):e.jsx("div",{className:"asset-sidebar-list",children:t.map(c=>e.jsxs("div",{className:"asset-sidebar-item",title:"ë”ë¸”í´ë¦­: í¬ê²Œ ë³´ê¸° / ìš°í´ë¦­: í”„ë¡¬í”„íŠ¸ ë³µì‚¬ ë©”ë‰´",draggable:!0,onDoubleClick:()=>$({url:c.url,prompt:c.prompt}),onDragStart:i=>{const g=JSON.stringify({type:"asset",url:c.url,prompt:c.prompt});i.dataTransfer.setData("application/json",g),i.dataTransfer.setData("text/plain",g),i.dataTransfer.effectAllowed="copyMove";const C=i.currentTarget.querySelector("img");C&&i.dataTransfer.setDragImage(C,50,50)},onContextMenu:i=>{i.preventDefault(),i.stopPropagation(),N({x:i.clientX,y:i.clientY,asset:c})},children:[e.jsx("img",{src:c.url,alt:"asset",draggable:!1}),e.jsxs("div",{className:"asset-sidebar-actions",children:[e.jsx("select",{value:c.category,onChange:i=>{W(g=>g.map(C=>C.id===c.id?{...C,category:i.target.value}:C))},onClick:i=>i.stopPropagation(),title:"ì¹´í…Œê³ ë¦¬ ë³€ê²½",className:"asset-category-select",children:V.filter(i=>i.id!=="default").map(i=>e.jsx("option",{value:i.id,children:i.name},i.id))}),e.jsx("button",{onClick:()=>{const i=document.createElement("a");i.href=c.url,i.download=`asset-${c.timestamp}.png`,i.click()},title:"ë‹¤ìš´ë¡œë“œ",children:"â¬‡"}),e.jsx("button",{onClick:()=>W(i=>i.filter(g=>g.id!==c.id)),title:"ì‚­ì œ",children:"Ã—"})]})]},c.id))})})(),E.length>0&&e.jsx("button",{className:"asset-clear-all",onClick:()=>W([]),children:"ì „ì²´ ì‚­ì œ"})]})]})]})}function Ft(){return e.jsx($t,{children:e.jsx(dt,{children:e.jsx(Ot,{})})})}export{Ft as default};
